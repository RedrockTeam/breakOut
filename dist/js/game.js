"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();$(window).on("scroll.elasticity",function(t){t.preventDefault()}).on("touchmove.elasticity",function(t){t.preventDefault()}),$(document).ready(function(){window.innerHeight>568&&(document.querySelector("#canvas").height=window.innerHeight);var t={canvas:document.querySelector("#canvas"),context:document.querySelector("#canvas").getContext("2d"),timer:null,run:!1,isStart:!1,stopTimer:function(){window.clearInterval(this.timer)}},i=function(){function i(){_classCallCheck(this,i),this.context=t.context,this.startX=0,this.startY=0,this.width=320,this.height=document.querySelector("#canvas").height,this.upFlag=!1,this.upPosLow=window.innerHeight/2}return _createClass(i,[{key:"refresh",value:function(){this.context.clearRect(this.startX,this.startY,this.width,this.height)}},{key:"up",value:function(t){this.upFlag=t<this.upPosLow,this.upFlag&&(this.context.translate(0,3),this.upPosLow-=3,this.startY-=3,window.innerHeight-=3)}},{key:"run",value:function(){t.timer=setInterval(function(){c.refresh(),c.up(l.getPos()[1]),f.move(),g.move(),l.collision(f.top,g.isClose),l.fall()},1e3/60),$(document).on("touchstart",function(){l.jump()})}}]),i}(),e=function(){function i(e,s,n,h,o){_classCallCheck(this,i),this.context=t.context,this.top=e,this.left=s,this.width=n,this.height=h,this.img=o,this.timer=null,this.exp=.1}return _createClass(i,[{key:"paint",value:function(){this.context.drawImage(this.img,this.left,this.top)}},{key:"jump",value:function(){this.exp=-5}},{key:"fall",value:function(){this.top+=this.exp,this.exp+=.2,this.paint(),this.isEnd()}},{key:"isEnd",value:function(){this.top>window.innerHeight&&(console.log("Fall down game over"),t.stopTimer())}},{key:"getPos",value:function(){return[this.left+this.width/2,this.top+this.height/2]}},{key:"collision",value:function(i,e){var s=this.getPos()[1];Math.abs(i-s)<10&&e&&(console.log("collision"),console.log("game over"),t.stopTimer())}}]),i}(),s=(function(){function i(e,s,n,h,o,a,r,c){_classCallCheck(this,i),this.context=t.context,this.start={x:e,y:s},this.width=n,this.height=h,this.img=o,this.rotateDeg=a,this.initDegree=a,this.testPoint={up:{y:this.start.y,zone:r,status:!0},down:{y:this.start.y+this.height,zone:c,status:!0}}}return _createClass(i,[{key:"paint",value:function(){this.context.save(),this.context.translate(this.start.x+.5*this.width,this.start.y+.5*this.height),this.context.rotate(this.rotateDeg),this.context.drawImage(this.img,-.5*this.width,-.5*this.height),this.context.restore()}},{key:"rotate",value:function(){var t=this;this.context.save(),this.context.translate(this.start.x+.5*this.width,this.start.y+.5*this.height),this.context.rotate(this.rotateDeg),this.context.clearRect(-.5*this.width,-.5*this.height,this.width,this.height),this.context.restore(),this.rotateDeg+=.02,this.rotateDeg>=2*Math.PI+this.initDegree&&(this.rotateDeg=this.initDegree);var i=0,e=0;this.testPoint.up.zone.map(function(e){return i+=t.rotateDeg>=e[0]&&t.rotateDeg<=e[1]}),this.testPoint.down.zone.map(function(i){return e+=t.rotateDeg>=i[0]&&t.rotateDeg<=i[1]}),this.testPoint.up.status=!(i>0),this.testPoint.down.status=!(e>0),this.paint()}}]),i}(),function(){function i(e,s,n,h,o,a,r,c,u){_classCallCheck(this,i),this.context=t.context,this.left=e,this.top=s,this.width=n,this.height=h,this.img=o,this.direction=a,this.maxLeft=r,this.maxRight=c,this.zone=u,this.isClose=!0}return _createClass(i,[{key:"paint",value:function(){this.context.drawImage(this.img,this.left,this.top)}},{key:"move",value:function(){var t=this.left+this.width/2,i=0;this.context.clearRect(this.left,this.top,this.width,this.height),this.zone.map(function(e){return i+=t>=e[0]&&t<=e[1]}),this.isClose=i>0,(this.direction&&t>=this.maxRight||!this.direction&&t<=this.maxLeft)&&(this.direction=!this.direction),this.direction?this.left+=1:this.left-=1,this.paint()}}]),i}()),n=(function(){function i(e,s,n,h,o){_classCallCheck(this,i),this.context=t.context,this.left=e,this.top=s,this.width=n,this.height=h,this.img=o,this.isAte=!1}return _createClass(i,[{key:"paint",value:function(){this.context.drawImage(this.img,this.left,this.top)}},{key:"eat",value:function(t){var i=this.top+this.height/2;console.log(i),Math.abs(i-t)<5&&(this.isAte=!0),this.isAte||this.paint()}}]),i}(),function(){function i(e,s,n,h,o){_classCallCheck(this,i),this.context=t.context,this.left=e,this.top=s,this.width=n,this.height=h,this.img=o,this.scale=1}return _createClass(i,[{key:"paint",value:function(){this.context.clearRect(this.left,this.top,this.width,this.height)}},{key:"blink",value:function(){this.paint()}}]),i}()),h=document.querySelector("#img-star"),o=document.querySelector("#img-rope"),a=document.querySelector("#img-touch"),r=window.innerHeight,c=new i,u=new n(145,r-280,40,60,a),l=new e(r-150,145,30,30,h),f=new s(0,r-300,80,13,o,!0,40,120,[[105,120]]),g=new s(240,r-300,80,13,o,!1,200,280,[[200,215]]);c.refresh(),window.setTimeout(function(){f.paint(),g.paint(),l.paint(),u.paint()},200),window.setInterval(function(){u.blink()},200),$("#container").on("touchstart",function(){t.run===!1&&(c.run(),t.run=!0,t.isStart=!0)})});